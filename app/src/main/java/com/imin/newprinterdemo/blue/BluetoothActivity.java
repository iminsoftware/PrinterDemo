package com.imin.newprinterdemo.blue;

import static com.imin.newprinterdemo.BaseApplication.mContext;

import android.Manifest;
import android.annotation.SuppressLint;
import android.annotation.TargetApi;
import android.app.Activity;
import android.bluetooth.BluetoothDevice;
import android.bluetooth.BluetoothSocket;
import android.content.Context;
import android.content.pm.PackageManager;
import android.graphics.Bitmap;
import android.os.Build;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.CheckBox;
import android.widget.ListView;
import android.widget.TextView;

import androidx.annotation.Nullable;
import androidx.core.app.ActivityCompat;

import com.imin.newprinterdemo.BaseActivity;
import com.imin.newprinterdemo.R;
import com.imin.newprinterdemo.databinding.ActivityBluetoothBinding;
import com.imin.newprinterdemo.utils.BytesUtils;

import java.io.IOException;
import java.util.List;

public class BluetoothActivity extends BaseActivity {
    private String string1 = "0000000000001B401B21001B61011D7630001700B4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFFC000000000000000000000000000000000000001FFFFFFFC0000000000000000000000000000000000003FFFFFFFFFC00000000000000000000000000000000000FFFFFFFFFFF00000000000000000000000000000000007FFFFFFFFFFFF000000000000000000000000000000001FFFFFFFFFFFFF80000000000000000000000000000000FFFFFFFFFFFFFFF0000000000000000000000000000001FFFFFFFFFFFFFFFC000000000000000000000000000007FFFFFF800FFFFFFF00000000000000000000000000001FFFFFC000001FFFFFC0000000000000000000000000003FFFFC00000003FFFFE000000000000000000000000000FFFFC0000000003FFFF800000000000000000000000001FFFF00000000000FFFFC00000000000000000000000007FFFC000000000001FFFE0000000000000000000000000FFFF0000000000000FFFF0000000000000000000000001FFFC00000000000001FFFC000000000000000000000003FFF000000000000000FFFE000000000000000000000007FFC0000000000000003FFF00000000000000000000001FFF80000000000000001FFF80000000000000000000003FFF000000000000000007FFC0000000000000000000007FFC000000000000000003FFE0000000000000000000007FF8000000000000000001FFF000000000000000000000FFF00000000000000000007FF800000000000000000001FFE00000000000000000003FFC00000000000000000003FFC00000000000000000001FFE00000000000000000007FF800000000000000000000FFE0000000000000000000FFF0000000000000000000007FF0000000000000000000FFE0000000000000000000003FF8000000000000000001FFC0000000FFFFFFF00000001FFC000000000000000003FF800001FFFFFFFFFFF800001FFC000000000000000003FF000007FFFFFFFFFFFF00000FFE000000000000000007FE00003FFFFFFFFFFFFFC00007FF00000000000000000FFE00007FFFFFFFFFFFFFE00003FF00000000000000000FFC0000FFFFFFFFFFFFFFF80001FF80000000000000001FF80001FFFFFFFFFFFFFFF80001FF80000000000000001FF00003FFFFFFFFFFFFFFFC0000FFC0000000000000003FF00007FFFFFFFFFFFFFFFE0000FFC0000000000000007FE00007FFFFFFFFFFFFFFFF00007FE0000000000000007FE0000FFFFFFFFFFFFFFFFF00003FE0000000000000007FC0000FFFFFFFFFFFFFFFFF00003FF000000000000000FFC0000FFFFFFFFFFFFFFFFF80001FF000000000000000FF80001FFFFFFFFFFFFFFFFFC0001FF800000000000001FF80003FFFFFFFFFFFFFFFFFC0000FF800000000000001FF00003FFFFFFFFFFFFFFFFFC0000FF800000000000001FF00003FFFFFFFFFFFFFFFFFE0000FFC00000000000003FE00007FFFFFFFFFFFFFFFFFE00007FC00000000000003FE00007FFFFFFFFFFFFFFFFFF00003FE00000000000007FE0000FFFFFFFFFFFFFFFFFFF00003FE00000000000007FC0000FFFFFFFFFFFFFFFFFFF00003FE00000000000007FC0000FFFFFFFFFFFFFFFFFFF80003FE00000000000007FC0001FFFFFFFFFFFFFFFFFFF80001FF00000000000007F80001FFFFFFFFFFFFFFFFFFFC0001FF0000000000000FF80001FFFFFFFFFFFFFFFFFFFC0001FF0000000000000FF80003FFFFFFFFFFFFFFFFFFFC0000FF0000000000000FF80003FFFFFFFFFFFFFFFFFFFE0000FF8000000000000FF00003FFFFFFFFFFFFFFFFFFFE0000FF8000000000001FF00007FFFFFFFFFFFFFFFFFFFE0000FF8000000000001FF00007FFFFFFFFFFFFFFFFFFFE0000FF8000000000001FF00007FFFFFFFFFFFFFFFFFFFF00007F8000000000001FF00007FFFFFFFFFFFFFFFFFFFF00007F8000000000001FF0000FFFFFFFFFFFFFFFFFFFFF00007F8000000000001FF0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE0000FFFFFFFFFFFFFFFFFFFFF00007FC000000000001FE00007FFFFBFFFFDFFFFEFFFFE00007FC000000000001FE00007FFFF1FFFF8FFFFC7FFFE00007FC000000000001FE00003FFFE0FFFF0FFFF83FFFC00007FC000000000001FE00001FFFC0FFFE07FFF01FFF800007FC000000000001FE00000FFF803FFC01FFE00FFF000007FC000000000001FE000003FE0E1FF000FF8383FC000007FC000000000001FF000000601F0180000C07C060000007F8000000000001FF000000007F800000000FF000000007F8000000000001FF00000001FF800000000FF800000007F8000000000001FF0000000FFF800000000FFF8000000FF8000000000001FF0000001FFF800000000FFF8000000FF8000000000000FF0000001FFF800000000FFF8000000FF8000000000000FF0000001FFF800000000FFF8000000FF8000000000000FF8000001FFF800000000FFF8000000FF0000000000000FF8000001FFF800000000FFF8000001FF0000000000000FF8000001FFF800000000FFF8000001FF00000000000007FC000000FFF800000000FFF8000001FF00000000000007FC000000FFF800000000FFF8000001FE00000000000007FC000000FFF800000000FFF8000003FE00000000000007FC000000FFFC00000001FFF8000003FE00000000000003FE000000FFFC00000003FFF8000003FE00000000000003FE000000FFFFFFFFFFFFFFF8000007FC00000000000003FF000000FFFFFFFFFFFFFFF8000007FC00000000000001FF000000FFFFFFFFFFFFFFF000000FFC00000000000001FF000000FFFFFFF07FFFFFF000000FF800000000000001FF800000FFFFFFC03FFFFFF000000FF800000000000000FFC000007FFFFF801FFFFFF000001FF800000000000000FFC000007FFFFF800FFFFFF000003FF0000000000000007FC000007FFFFF000FFFFFE000003FE0000000000000007FE000007FFFFF000FFFFFE000007FE0000000000000003FF000003FFFFF0007FFFFC000007FE0000000000000003FF000001FFFFF000FFFFFC00000FFC0000000000000001FF800001FFFFF800FFFFF800001FFC0000000000000001FFC00000FFFFF801FFFFF000001FF80000000000000000FFC000007FFFFC03FFFFE000003FF00000000000000000FFE000001FFFFE07FFFFC000007FF000000000000000007FF0000007FFFFFFFFFF0000007FE000000000000000003FF8000001FFFFFFFFFC000000FFE000000000000000003FF80000000FFFFFFF00000001FFC000000000000000001FFC000000000FFF0000000003FF8000000000000000000FFE0000000000000000000007FF00000000000000000007FF000000000000000000000FFF00000000000000000003FF800000000000000000001FFE00000000000000000003FFC00000000000000000003FFC00000000000000000001FFE00000000000000000007FF800000000000000000000FFF8000000000000000000FFF0000000000000000000007FFC000000000000000001FFE0000000000000000000003FFE000000000000000007FFC0000000000000000000001FFF00000000000000000FFF80000000000000000000000FFFC0000000000000001FFF000000000000000000000007FFF0000000000000007FFE000000000000000000000003FFF800000000000001FFFC000000000000000000000000FFFE00000000000007FFF80000000000000000000000007FFF8000000000000FFFF00000000000000000000000003FFFE000000000007FFFC00000000000000000000000001FFFF80000000001FFFF8000000000000000000000000007FFFF800000000FFFFF0000000000000000000000000003FFFFF0000000FFFFFC0000000000000000000000000000FFFFFF80001FFFFFF000000000000000000000000000003FFFFFFFFFFFFFFFE000000000000000000000000000000FFFFFFFFFFFFFFF80000000000000000000000000000003FFFFFFFFFFFFFC00000000000000000000000000000000FFFFFFFFFFFFF8000000000000000000000000000000001FFFFFFFFFFF800000000000000000000000000000000007FFFFFFFFFE0000000000000000000000000000000000007FFFFFFFE000000000000000000000000000000000000007FFFFFF00000000000000000000000000000000000000000FFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A1B61001D76300001000A00000000000000000000000A1B61011B45011B2D001D21004F75746C657420310D0A1B45001B2D004B61707061206B616D616C2C204B6F7461204A616B617274612042617261742C20444B49204A616B617274612C2031313735300D0A3038373837343532323732380D0A0D0A1B61003239204A756E20323032312020202020202020202020202020202031383A33310D0A52656365697074204E756D626572202020202020202020202020364D51544B580D0A4F726465722049442020202020202020202020202020202020385455303030310D0A436F6C6C656374656420427920202020202020202020202020206461766964200D0A2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0D0A1B45011B2D006B6F706920486974616D0D0A1B61021B45001B2D0031782020204031352E303030202020202020202020202020202031352E3030300D0A1B61001D76300001000A00000000000000000000000A1B45011B2D004B6F706920737573750D0A1B61021B45001B2D0031782020204031382E303030202020202020202020202020202031382E3030300D0A1B61001D76300001000A00000000000000000000000A1B45011B2D00546568206D616E69730D0A1B61021B45001B2D00317820202040352E30303020202020202020202020202020202020352E3030300D0A1B61002D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0D0A537562746F74616C20202020202020202020202020202052702033382E3030300D0A2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0D0A1B45011B2D00546F74616C20202020202020202020202020202020202052702033382E3030300D0A1B45001B2D002D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0D0A436173682020202020202020202020202020202020202052702034302E3030300D0A4368616E6765202020202020202020202020202020202020527020322E3030300D0A2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0D0A1D7630002E002A000007F800000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC000000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000000040000040000040000000000000000000000000000000000000000000000000000000000000000FFFFFFC00000000E00000E00000E0000000000000000000000000000000000000000000000000000000000000001FFFFFFE00000000E00000E00000E0000000000000000000000000000000000000000000000000000000000000003FFF83FF00000000E00000E00000E0000000000000000000000000000000000000000000000000000000000000003FFF03FF00000000E00000E00000E0000000000000000000000000000000000000000000000000000000000000007FFE03FF800003C0E183C0E183C0E183C000000000000000000000000000000000000000000000000000000000007FFE1FFF800007F0E387F0E387F0E387F000000000000000000000000000000000000000000000000000000000007FFE1FFF80000C38E70C38E70C38E70C380000000000000000000000000000000000000000000000000000000000FFFE1FFFC0001C18EE1C18EE1C18EE1C180000000000000000000000000000000000000000000000000000000000FFFC1FFFC0001818FC1818FC1818FC18180000000000000000000000000000000000000000000000000000000000FFF003FFC000181CF8181CF8181CF8181C0000000000000000000000000000000000000000000000000000000000FFF003FFC000180CFC180CFC180CFC180C0000000000000000000000000000000000000000000000000000000000FFF003FFC0001818EE1818EE1818EE18180000000000000000000000000000000000000000000000000000000000FFF003FFC0001818E71818E71818E718180000000000000000000000000000000000000000000000000000000000FFFE1FFFC0000C18E30C18E30C18E30C180000000000000000000000000000000000000000000000000000000000FFFE1FFFC0000F70E18F70E18F70E18F7000000000000000000000000000000000000000000000000000000000007FFE1FFF800003E0E1C3E0E1C3E0E1C3E000000000000000000000000000000000000000000000000000000000007FFE1FFF8000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFE1FFF8000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFE1FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFE1FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFE1FFE0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC00000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF800000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007F80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A1D7630002E002A000007F800000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC000000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000000040000040080000000000000000000000000000000000000000000000000000000000000000000FFFFFFC00000000E00000E01C0000000000000000000000000000000000000000000000000000000000000000001FFFFFFE00000000E00000E01C0000000000000000000000000000000000000000000000000000000000000000003FFFFFFF00000000E00000E01C0000000000000000000000000000000000000000000000000000000000000000003FFFF1FF00000000E00000E01C0000000000000000000000000000000000000000000000000000000000000000007FFFE01F800003C0E183C0E19C3078000000000000000000000000000000000000000000000000000000000000007F9FC03F800007F0E387F0E39C70FE000000000000000000000000000000000000000000000000000000000000007F8FC03F80000C38E70C38E71CE18700000000000000000000000000000000000000000000000000000000000000FF83C03FC0001C18EE1C18EE1DC38300000000000000000000000000000000000000000000000000000000000000FFC0003FC0001818FC1818FC1F830300000000000000000000000000000000000000000000000000000000000000FF80003FC000181CF8181CF81F030380000000000000000000000000000000000000000000000000000000000000FF80007FC000180CFC180CFC1F830180000000000000000000000000000000000000000000000000000000000000FF80007FC0001818EE1818EE1DC30300000000000000000000000000000000000000000000000000000000000000FFE0007FC0001818E71818E71CE30300000000000000000000000000000000000000000000000000000000000000FFC000FFC0000C18E30C18E31C618300000000000000000000000000000000000000000000000000000000000000FFE000FFC0000F70E18F70E19C31EE000000000000000000000000000000000000000000000000000000000000007FF001FF800003E0E1C3E0E1DC387C000000000000000000000000000000000000000000000000000000000000007FF803FF8000000000000000000000000000000000000000000000000000000000000000000000000000000000007FE007FF8000000000000000000000000000000000000000000000000000000000000000000000000000000000003F801FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFFFE0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC00000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF800000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007F80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A1D7630002E002A000007F800000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC000000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF80000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000080000080000080000080000000000000000000000000000000000000000000000000000000000000FFFFFFC00001C00001C00001C00001C0000000000000000000000000000000000000000000000000000000000001FFFFFFE00001C00001C00001C00001C0000000000000000000000000000000000000000000000000000000000003FFFFFFF00001C00001C00001C00001C0000000000000000000000000000000000000000000000000000000000003FFFFFFF00001C00001C00001C00001C0000000000000000000000000000000000000000000000000000000000007FC000FF80001C30781C30781C30781C3000000000000000000000000000000000000000000000000000000000007FC006FF80001C70FE1C70FE1C70FE1C7000000000000000000000000000000000000000000000000000000000007FC006FF80001CE1871CE1871CE1871CE00000000000000000000000000000000000000000000000000000000000FFC000FFC0001DC3831DC3831DC3831DC00000000000000000000000000000000000000000000000000000000000FFC1E0FFC0001F83031F83031F83031F800000000000000000000000000000000000000000000000000000000000FFC3F0FFC0001F03039F03039F03039F000000000000000000000000000000000000000000000000000000000000FFDBF6FFC0001F83019F83019F83019F800000000000000000000000000000000000000000000000000000000000FFDBF6FFC0001DC3031DC3031DC3031DC00000000000000000000000000000000000000000000000000000000000FFDBF6FFC0001CE3031CE3031CE3031CE00000000000000000000000000000000000000000000000000000000000FFD9E6FFC0001C61831C61831C61831C600000000000000000000000000000000000000000000000000000000000FFDC0EFFC0001C31EE1C31EE1C31EE1C3000000000000000000000000000000000000000000000000000000000007FDFFEFF80001C387C1C387C1C387C1C3800000000000000000000000000000000000000000000000000000000007FDFFEFF8000000000000000000000000000000000000000000000000000000000000000000000000000000000007FC000FF8000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFFFFFF0000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFFFE0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFFFC00000000000000000000000000000000000000000000000000000000000000000000000000000000000007FFFFF800000000000000000000000000000000000000000000000000000000000000000000000000000000000001FFFFE000000000000000000000000000000000000000000000000000000000000000000000000000000000000000FFFFC0000000000000000000000000000000000000000000000000000000000000000000000000000000000000003FFF000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007F80000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000A0D0A0D0A0D0A";
    private String string3 = "1B2400001B61311D21111C2E534554544C454D454E540A1B2400001B61311D21001C2E2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0A1B2400001B61311D21111C2E31352E30332E323032320A1B2400001B61311D21001C2E2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0A1B2400001D21001C2E434153482E1B245C001C2E242D35332E38301B2473011C2E0A1B2400001D21001C2E1B245C001C2E533A202435332E38301B24CB011B61321C2E4C3A2024302E30300A1B2400001D21001C2E4E4554532E1B245C001C2E242D31342C3531352E30301B2473011C2E0A1B2400001D21001C2E1B245C001C2E533A202431342C3531352E30301B24CB011B61321C2E4C3A2024302E30300A1B2400001D21001C2E566973612E1B245C001C2E24302E30301B2473011C2E0A1B2400001D21001C2E1B245C001C2E533A2024302E30301B24CB011B61321C2E4C3A2024302E30300A1B2400001D21001C2E4D61737465722E1B245C001C2E242D31352E30301B2473011C2E0A1B2400001D21001C2E1B245C001C2E533A202431352E30301B24CB011B61321C2E4C3A2024302E30300A1B2400001D21001C2E477261622E1B245C001C2E242D36352E30301B2473011C2E0A1B2400001D21001C2E1B245C001C2E533A202436352E30301B24CB011B61321C2E4C3A2024302E30300A1B2400001B61311D21001C2E2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0A1B2400001B61321B45011D21001C2E544F54414C3A0A1B2400001D21001C2E5365727665723A202431342C3634382E38300A1B2400001B61321D21001C2E4C6F63616C3A2024302E30300A1B2400001B61311D21001C2E2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D2D0A1B64010A0A0A0A0A1D56301B6401";

    private Bitmap bitmap;
    Thread thread;

    ActivityBluetoothBinding binding;
    private List<BluetoothDevice> printerDevices;
    private static final int REQUEST_CODE = 1;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        binding = ActivityBluetoothBinding.inflate(LayoutInflater.from(this));
        setContentView(binding.getRoot());
        initPermission();
        if (!BluetoothUtil.isBluetoothOn()) {
            BluetoothUtil.openBluetooth(BluetoothActivity.this);
        }
        initView();
    }

    @Override
    protected void onResume() {
        super.onResume();
        if (BluetoothUtil.isBluePrint) {
            binding.connect.setText(R.string.bluetooth_connected);
        } else {
            binding.connect.setText(R.string.connect_bluetooth_service);
        }
    }

    private void initView() {
        mAdapter = new DeviceListAdapter(this);
        binding.devicesList.setAdapter(mAdapter);
        binding.devicesList.setOnItemClickListener(new AdapterView.OnItemClickListener() {
            @Override
            public void onItemClick(AdapterView<?> parent, View view, int position, long id) {
                bluetoothPosition = position;
                mAdapter.notifyDataSetChanged();
            }
        });
        binding.connect.setOnClickListener(v -> {

            if (BluetoothUtil.isBluetoothOn()) {
                fillAdapter();
            } else {
                BluetoothUtil.openBluetooth(BluetoothActivity.this);
                fillAdapter();
            }
        });

        binding.print.setOnClickListener(v -> {
            Log.d("PrintDemoBlueActivity","binding.print=== 》"+(BluetoothUtil.bluetoothPrintUtil != null)
                + ", isBluePrint = " + BluetoothUtil.isBluePrint
            );
            if (BluetoothUtil.isBluePrint && BluetoothUtil.bluetoothPrintUtil != null) {
                byte[] b = BytesUtils.hexStringToBytes(string1);
                BluetoothUtil.bluetoothPrintUtil.print(b);
            }
        });

        binding.print1.setOnClickListener(v -> {
            Log.d("PrintDemoBlueActivity","binding.print1=== 》"+(BluetoothUtil.bluetoothPrintUtil != null)
                    + ", isBluePrint = " + BluetoothUtil.isBluePrint
            );
            if (BluetoothUtil.isBluePrint && BluetoothUtil.bluetoothPrintUtil != null) {
                byte[] b = BytesUtils.hexStringToBytes(string3);
                BluetoothUtil.bluetoothPrintUtil.print(b);
            }
        });
    }

    private void initPermission() {
        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {
            if (ActivityCompat.checkSelfPermission(BluetoothActivity.this,
                    Manifest.permission.BLUETOOTH_CONNECT) != PackageManager.PERMISSION_GRANTED
                    || ActivityCompat.checkSelfPermission(BluetoothActivity.this, Manifest.permission.BLUETOOTH_SCAN) != PackageManager.PERMISSION_GRANTED
                    || ActivityCompat.checkSelfPermission(BluetoothActivity.this, Manifest.permission.BLUETOOTH_ADVERTISE) != PackageManager.PERMISSION_GRANTED) {
                ActivityCompat.requestPermissions(BluetoothActivity.this,
                        new String[]{Manifest.permission.BLUETOOTH_CONNECT, Manifest.permission.BLUETOOTH_SCAN, Manifest.permission.BLUETOOTH_ADVERTISE}, REQUEST_CODE);
            }
        }
    }

    DeviceListAdapter mAdapter;

    private void fillAdapter() {
        printerDevices = BluetoothUtil.getPairedDevices();

        Log.d("PrintDemoBlueActivity","bluetooth addr=== 》"+(printerDevices != null && printerDevices.size()>0));
        if (printerDevices != null && printerDevices.size()>0){
            thread = new Thread(new Runnable() {
                @Override
                public void run() {

                    for (int i=0;i<printerDevices.size();i++){
                        BluetoothDevice device = printerDevices.get(i);
                        if (device != null){
                            Log.d("PrintDemoBlueActivity","蓝牙地址=== 》"+device.getAddress());
                            if (device.getAddress().equals("00:11:22:33:44:55")){
                                BluetoothUtil.initPrinter(device);
                                runOnUiThread(new Runnable() {
                                    @Override
                                    public void run() {
                                        binding.connect.setText(R.string.bluetooth_connected);
                                    }
                                });
                                break;
                            }

                        }
                    }
                }
            });
            thread.start();
        }

    }

    private void refreshButtonText(List<BluetoothDevice> printerDevices) {
        if (printerDevices.size() > 0) {
            binding.devicesList.setVisibility(View.VISIBLE);
        }
    }

    private int bluetoothPosition = -1;

    class DeviceListAdapter extends ArrayAdapter<BluetoothDevice> {

        public DeviceListAdapter(Context context) {
            super(context, 0);
        }

        @Nullable
        @Override
        public BluetoothDevice getItem(int position) {
            return (printerDevices == null || printerDevices.size() == 0) ? null : printerDevices.get(position);
        }

        @SuppressLint("MissingPermission")
        @TargetApi(Build.VERSION_CODES.ECLAIR)
        @Override
        public View getView(int position, View convertView, ViewGroup parent) {

            BluetoothDevice device = getItem(position);
            if (convertView == null) {
                convertView = LayoutInflater.from(getContext()).inflate(R.layout.item_bluetooth_device, parent, false);
            }

            TextView tvDeviceName = (TextView) convertView.findViewById(R.id.tv_device_name);
            CheckBox cbDevice = (CheckBox) convertView.findViewById(R.id.cb_device);

            tvDeviceName.setText(device.getName());

            cbDevice.setChecked(position == bluetoothPosition);

            return convertView;
        }
    }

    @Override
    protected void onDestroy() {
        super.onDestroy();
    }
}